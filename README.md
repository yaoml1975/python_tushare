# é¡¹ç›®ä»‹ç»ï¼šåŸºäºå·´è²ç‰¹é€‰è‚¡ç­–ç•¥çš„é‡åŒ–é€‰è‚¡å·¥å…· - python_tushare

## ğŸ“– é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯åŸºäºæ²ƒä¼¦Â·å·´è²ç‰¹(Warren Buffett)ä»·å€¼æŠ•èµ„ç­–ç•¥æ„å»ºçš„é‡åŒ–é€‰è‚¡å·¥å…·ï¼Œé€šè¿‡è°ƒç”¨**Tushareé‡‘èæ•°æ®æ¥å£**ï¼Œå®ç°äº†å·´è²ç‰¹ä»·å€¼æŠ•èµ„ç­–ç•¥çš„è‡ªåŠ¨åŒ–ç­›é€‰é€‰è‚¡æµç¨‹ã€‚è¯¥ç¨‹åºå°†å·´è²ç‰¹çš„ç»å…¸é€‰è‚¡åŸåˆ™è½¬åŒ–ä¸ºå¯é‡åŒ–çš„æŒ‡æ ‡ï¼Œé€šè¿‡å››ä¸ªç³»ç»ŸåŒ–çš„æ­¥éª¤å¯¹Aè‚¡å¸‚åœºè‚¡ç¥¨è¿›è¡Œç­›é€‰ï¼Œå¸®åŠ©æŠ•èµ„è€…å‘ç°å…·æœ‰é•¿æœŸæŠ•èµ„ä»·å€¼çš„ä¼˜è´¨ä¼ä¸šã€‚æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

- **å››å¤§ç­›é€‰æ¨¡å—**ï¼šä»æµåŠ¨æ€§ã€ä¼°å€¼æ°´å¹³ã€è´¢åŠ¡æŒ‡æ ‡åˆ°æŠ€æœ¯é¢çš„é€’è¿›å¼ç­›é€‰
- **æ•°æ®æ•´åˆ**ï¼šæ•´åˆTushare Proçš„è¡Œæƒ…ã€è´¢åŠ¡ã€åŸºæœ¬é¢ç­‰å¤šç»´åº¦æ•°æ®
- **è‡ªåŠ¨åŒ–æµç¨‹**ï¼šæ”¯æŒä»æ•°æ®è·å–åˆ°æœ€ç»ˆé€‰è‚¡çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–
- **å¯é…ç½®ç­–ç•¥**ï¼šé€šè¿‡config.yamlæ–‡ä»¶çµæ´»è°ƒæ•´ç­›é€‰å‚æ•°

## ğŸ’– æ”¯æŒå¼€æº
**æ‚¨çš„æ”¯æŒæ˜¯æœ¬é¡¹ç›®æŒç»­ä¼˜åŒ–ä¸å¼€æºçš„æœ€å¤§åŠ¨åŠ›ï¼**  
å¦‚æœæ‚¨æ„¿æ„æ”¯æŒæˆ‘ä»¬ï¼Œå¯é€šè¿‡å¾®ä¿¡æ‰«ç æèµ ã€‚æ‰€æœ‰æèµ å°†ç”¨äºï¼š
- ğŸ› ï¸ **ä»£ç ä¼˜åŒ–**ï¼šæ”¹è¿›ç®—æ³•æ€§èƒ½ä¸ç­–ç•¥å‡†ç¡®æ€§
- ğŸ“Š **æ•°æ®ç»´æŠ¤**ï¼šæ”¯ä»˜Tushare Proæ¥å£è´¹ç”¨åŠæœåŠ¡å™¨æˆæœ¬
- ğŸš€ **åŠŸèƒ½æ‰©å±•**ï¼šå¼€å‘å›æµ‹æ¡†æ¶ã€GUIç•Œé¢ç­‰æ–°åŠŸèƒ½
- ğŸ“š **å¼€æºç”Ÿæ€**ï¼šå®Œå–„æ–‡æ¡£åŠç¤¾åŒºæŠ€æœ¯æ”¯æŒ


#### å¾®ä¿¡æèµ äºŒç»´ç 

<img src="images/wechat-donate.png" alt="å¾®ä¿¡æèµ äºŒç»´ç " style="zoom:33%;" />

> **èµ„é‡‘é€æ˜æ‰¿è¯º**  
> æèµ æ˜ç»†åŠç”¨é€”å°†åœ¨[æ›´æ–°æ—¥å¿—](CHANGELOG.md)ä¸­å®šæœŸå…¬ç¤ºï¼Œç¡®ä¿å¼€æºé¡¹ç›®çš„å¯æŒç»­æ€§å‘å±•ã€‚

---

## ğŸ›  æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

#### ç¼–ç¨‹è¯­è¨€:
  - Python 3.9.21

#### æ•°æ®æ¥å£: 
  - Tushare Pro API (éœ€æ³¨å†Œè·å–token)

#### ä¸»è¦ä¾èµ–åº“:ï¼ˆè¯¦è§:requirements.txt)
  - pandas (æ•°æ®å¤„ç†)
  - numpy (æ•°å€¼è®¡ç®—)
  - tushare (é‡‘èæ•°æ®è·å–)
  - matplotlib/seaborn (å¯è§†åŒ–)
  - requests (APIè°ƒç”¨)
  - logging (æ—¥å¿—è®°å½•)

### æ•°æ®æº - Tushare Pro

é€šè¿‡**Tushare Pro**æ¥å£è·å–ä»¥ä¸‹é‡‘èæ•°æ®:**ï¼ˆéœ€ç”³è¯·5000ç§¯åˆ†çš„tokenï¼‰**
  - è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
  - è´¢åŠ¡æ•°æ®(èµ„äº§è´Ÿå€ºè¡¨ã€åˆ©æ¶¦è¡¨ã€ç°é‡‘æµé‡è¡¨)
  - è¡Œæƒ…æ•°æ®(æ—¥Kçº¿ã€å¤æƒå› å­)
  - ä¼°å€¼æŒ‡æ ‡(PE/PB/PSç­‰)


## å·´è²ç‰¹é€‰è‚¡ç­–ç•¥çš„å››æ­¥å®ç°

### è‚¡ç¥¨ç­›é€‰ç¨‹åº - tushare_test1.py

#### åŠŸèƒ½æè¿°

æœ¬ç¨‹åºé€šè¿‡load_or_fetch_stock_basic è·å–ä¸Šå¸‚å…¬å¸åŸºç¡€ä¿¡æ¯ã€‚æ ¹æ®ä»¥ä¸‹è§„åˆ™ç­›é€‰è‚¡ç¥¨ï¼š
  - æ’é™¤è¿‘ä¸¤å¹´ä¸Šå¸‚çš„è‚¡ç¥¨ï¼š**(æš‚æœªæ’é™¤)**
  - æ’é™¤åç§°å« "ST" çš„è‚¡ç¥¨ï¼›
  - æ’é™¤ä»£ç ä»¥ "8" æˆ– "9" å¼€å¤´çš„è‚¡ç¥¨ï¼ˆæ–°ä¸‰æ¿å’Œ B è‚¡å¸‚åœºï¼‰ï¼›
  - æ’é™¤æ‰æ°‘è¥ä¼ä¸šã€å¤–èµ„ä¼ä¸šçš„è‚¡ç¥¨ï¼›**(æš‚æœªæ’é™¤)**
  - ä»…ä¿ç•™å¸‚åœºç±»å‹marketä¸º"ä¸»æ¿"çš„è‚¡ç¥¨ï¼›**(æœªé€‰æ‹©)**
  - æ’é™¤æ°‘è¥ä¼ä¸šå’Œå¤–èµ„ä¼ä¸šï¼›**(æš‚æœªæ’é™¤)**
  - ä»…ä¿ç•™é“¶è¡Œï¼›**(æœªé€‰æ‹©)**

ä¿å­˜ç»“æœä¸º tushare_stock_basic_filter_äº¤æ˜“æ—¥æœŸ.csv

#### è¾“å…¥å†…å®¹

äº¤æ˜“æ—¥æœŸï¼šæœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥ã€‚å¯é€šè¿‡å·¥å…·ç±»stock_utilsçš„å‡½æ•°get_last_trade_date()è·å–æœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥æœŸã€‚

#### è¾“å‡ºæ–‡ä»¶å’Œå†…å®¹

CSV æ–‡ä»¶ï¼š`tushare_stock_basic_filter1_äº¤æ˜“æ—¥æœŸ.csv`ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
   1. `ts_code`ï¼šè‚¡ç¥¨ä»£ç ã€‚
   2. `name`ï¼šè‚¡ç¥¨åç§°ã€‚
   3. `area`ï¼šåœ°åŸŸã€‚
   4. `industry`ï¼šæ‰€å±è¡Œä¸šã€‚
   5. `market`ï¼šå¸‚åœºç±»å‹ã€‚
   6. `list_status`ï¼šä¸Šå¸‚çŠ¶æ€ã€‚
   7. `list_date`ï¼šä¸Šå¸‚æ—¥æœŸã€‚
   8. `is_hs`ï¼šæ˜¯å¦æ²ªæ·±æ¸¯é€šæ ‡çš„ã€‚

---

### è‚¡ç¥¨ç­›é€‰ç¨‹åº - tushare_test2.py

#### åŠŸèƒ½æè¿°

1. è·å–æœ€è¿‘äº¤æ˜“æ—¥æœŸã€‚
2. è¯»å– `tushare_stock_basic_filter1_äº¤æ˜“æ—¥æœŸ.csv`ï¼ˆåŸºç¡€ç­›é€‰ç»“æœï¼Œä»¥ä¸‹ç®€ç§° csv1ï¼‰ã€‚
3. è¯»å– `tushare_daily_äº¤æ˜“æ—¥æœŸ.csv`ï¼ˆæ—¥çº¿è¡Œæƒ…æ•°æ®ï¼Œä»¥ä¸‹ç®€ç§° csv2ï¼‰å’Œ`tushare_daily_basic_äº¤æ˜“æ—¥æœŸ.csv`ï¼ˆæ¯æ—¥æŒ‡æ ‡æ•°æ®ï¼Œä»¥ä¸‹ç®€ç§° csv3ï¼‰ã€‚
4. ä»…åˆå¹¶ `csv1` ä¸­åŒ…å«çš„è‚¡ç¥¨ï¼Œåœ¨ `csv2` å’Œ `csv3` ä¸­å¯¹åº”çš„æ•°æ®ã€‚
5. æ ¹æ®ä»¥ä¸‹è§„åˆ™ç­›é€‰è‚¡ç¥¨ï¼š
  - æ’é™¤æµé€šå¸‚å€¼ï¼ˆcirc_mvï¼‰å¤§äº 1000 äº¿çš„è‚¡ç¥¨ã€‚**ï¼ˆconfig.yamlä¸­circ_mvæŒ‡æ ‡å®šä¹‰ï¼‰**
  - æ’é™¤å¸‚ç›ˆç‡ï¼ˆpeï¼‰å°äº 5 æˆ–å¤§äº 50 çš„è‚¡ç¥¨ã€‚**(æš‚æœªæ’é™¤)**
6. ä¿å­˜ç­›é€‰ç»“æœä¸º `tushare_stock_basic_filter2_äº¤æ˜“æ—¥æœŸ.csv`ã€‚

#### è¾“å…¥å†…å®¹

1. äº¤æ˜“æ—¥æœŸï¼šæœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥ï¼ˆé€šè¿‡ `get_last_trade_date` è·å–ï¼‰ã€‚
2. è¾“å…¥æ–‡ä»¶ï¼š
  - `tushare_stock_basic_filter1_äº¤æ˜“æ—¥æœŸ.csv`ï¼ˆcsv1ï¼‰ã€‚
  - `tushare_daily_äº¤æ˜“æ—¥æœŸ.csv`ï¼ˆcsv2ï¼‰ã€‚
  - `tushare_daily_basic_äº¤æ˜“æ—¥æœŸ.csv`ï¼ˆcsv3ï¼‰ã€‚

#### è¾“å‡ºæ–‡ä»¶å’Œå†…å®¹

CSV æ–‡ä»¶ï¼š`tushare_stock_basic_filter2_äº¤æ˜“æ—¥æœŸ.csv`ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
  - `ts_code`ï¼šè‚¡ç¥¨ä»£ç ã€‚
  - `name`ï¼šè‚¡ç¥¨åç§°ã€‚
  - `area`ï¼šåœ°åŸŸã€‚
  - `industry`ï¼šæ‰€å±è¡Œä¸šã€‚
  - `market`ï¼šå¸‚åœºç±»å‹ã€‚
  - `list_status`ï¼šä¸Šå¸‚çŠ¶æ€ã€‚
  - `list_date`ï¼šä¸Šå¸‚æ—¥æœŸã€‚
  - `is_hs`ï¼šæ˜¯å¦æ²ªæ·±æ¸¯é€šæ ‡çš„ã€‚
  - `vol`ï¼šæˆäº¤é‡ã€‚
  - `turnover_rate`ï¼šæ¢æ‰‹ç‡ã€‚
  - `pct_chg`ï¼šæ¶¨è·Œå¹…ã€‚
  - `circ_mv`ï¼šæµé€šå¸‚å€¼ã€‚
  - `volume_ratio`ï¼šé‡æ¯”ã€‚

---

### è‚¡ç¥¨ç­›é€‰ç¨‹åº - tushare_test3.py

#### åŠŸèƒ½æè¿°

1. è·å–æœ€è¿‘äº¤æ˜“æ—¥æœŸã€‚
2. è¯»å– `tushare_stock_basic_filter2_äº¤æ˜“æ—¥æœŸ.csv` æ–‡ä»¶ï¼Œæå–è‚¡ç¥¨ä¿¡æ¯ã€‚
3. å¯¹æ¯åªè‚¡ç¥¨ï¼Œè·å–å…¶ `list_date`ï¼ˆä¸Šå¸‚æ—¥æœŸï¼‰ï¼Œæå–å¹´ä»½ï¼Œå¹¶é€šè¿‡`generate_quarter_list(start_year)` è·å–ä»æŒ‡å®šå¹´ä»½åˆ°å½“å‰å¹´ä»½çš„å­£åº¦åˆ—è¡¨ã€‚
4. é€šè¿‡ `fetch_fina_indicator_vip_by_tscode(ts_code, quarter_list, is_save_csv=True)` è·å–æ¯åªè‚¡ç¥¨çš„è´¢åŠ¡æ•°æ®ã€‚
5. æ ¹æ®ä»¥ä¸‹è§„åˆ™ç­›é€‰è‚¡ç¥¨ï¼š
  - æ’é™¤å‡€èµ„äº§æ”¶ç›Šç‡ï¼ˆ`roe`ï¼‰å°äº4 çš„è‚¡ç¥¨ã€‚**ï¼ˆconfig.yamlä¸­æŒ‡å®šï¼‰**
  - æ’é™¤å‡€åˆ©æ¶¦å¢é•¿ç‡ï¼ˆ`q_netprofit_yoy`ï¼‰å°äº0 çš„è‚¡ç¥¨ã€‚***ï¼ˆconfig.yamlä¸­æŒ‡å®šï¼‰**
  - æ’é™¤èµ„äº§è´Ÿå€ºç‡ï¼ˆ`debt_to_assets`ï¼‰å¤§äº 80è‚¡ç¥¨ã€‚***ï¼ˆconfig.yamlä¸­æŒ‡å®šï¼‰**
  - æ’é™¤ä¼ä¸šè‡ªç”±ç°é‡‘æµé‡ï¼ˆ`fcff`ï¼‰ä¸ºè´Ÿçš„è‚¡ç¥¨ã€‚**(æš‚æœªæ’é™¤)**
6. ä¿å­˜ç­›é€‰ç»“æœä¸º `tushare_stock_basic_filter3_äº¤æ˜“æ—¥æœŸ.csv` æ–‡ä»¶ã€‚

#### è¾“å‡ºæ–‡ä»¶å’Œå†…å®¹

CSV æ–‡ä»¶ï¼š`tushare_stock_basic_filter3_äº¤æ˜“æ—¥æœŸ.csv` åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
  - `ts_code`ï¼šè‚¡ç¥¨ä»£ç ã€‚
  - `name`ï¼šè‚¡ç¥¨åç§°ã€‚
  - `area`ï¼šåœ°åŸŸã€‚
  - `industry`ï¼šæ‰€å±è¡Œä¸šã€‚
  - `market`ï¼šå¸‚åœºç±»å‹ã€‚
  - `list_status`ï¼šä¸Šå¸‚çŠ¶æ€ã€‚
  - `list_date`ï¼šä¸Šå¸‚æ—¥æœŸã€‚
  - `is_hs`ï¼šæ˜¯å¦æ²ªæ·±æ¸¯é€šæ ‡çš„ã€‚
  - `vol`ï¼šæˆäº¤é‡ã€‚
  - `turnover_rate`ï¼šæ¢æ‰‹ç‡ã€‚
  - `pct_chg`ï¼šæ¶¨è·Œå¹…ã€‚
  - `circ_mv`ï¼šæµé€šå¸‚å€¼ã€‚
  - `volume_ratio`ï¼šé‡æ¯”ã€‚
  - `ann_date`ï¼šå…¬å‘Šæ—¥æœŸã€‚  
  - `end_date`ï¼šæŠ¥å‘ŠæœŸã€‚  
  - `roe`ï¼šå‡€èµ„äº§æ”¶ç›Šç‡ã€‚  
  - `fcff`ï¼šä¼ä¸šè‡ªç”±ç°é‡‘æµé‡ã€‚  
  - `grossprofit_margin`ï¼šé”€å”®æ¯›åˆ©ç‡ã€‚  
  - `equity_yoy`ï¼šå‡€èµ„äº§åŒæ¯”å¢é•¿ç‡ã€‚  
  - `debt_to_assets`ï¼šèµ„äº§è´Ÿå€ºç‡ã€‚  
  - `update_flag`ï¼šæ›´æ–°æ ‡è¯†ã€‚

#### åˆå¹¶æ–‡ä»¶åŠŸèƒ½

1. ä½¿ç”¨ `merge_csv_files(file1, file2, output_file)` åˆå¹¶ä¸¤ä¸ª CSV æ–‡ä»¶ï¼Œä¿ç•™ä¸¤ä¸ªæ–‡ä»¶ä¸­éƒ½æœ‰çš„è®°å½•ã€‚
2. é€šè¿‡ `ts_code` åˆ—è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶ç»“æœä¿å­˜ä¸º `tushare_stock_basic_filter3_äº¤æ˜“æ—¥æœŸ_merged.csv` æ–‡ä»¶ã€‚

---

### è‚¡ç¥¨ç­›é€‰ç¨‹åº - tushare_test4.py

#### åŠŸèƒ½æè¿°

1. è·å–æœ€è¿‘äº¤æ˜“æ—¥æœŸã€‚
2. è¯»å– `data/tushare_stock_basic_filter3_äº¤æ˜“æ—¥æœŸ_merged.csv` æ–‡ä»¶ï¼Œæå–è‚¡ç¥¨ä¿¡æ¯ã€‚
3. è°ƒç”¨get_recent_kdj_death_cross(ts_code)è·å–æŒ‡å®šè‚¡ç¥¨æœ€è¿‘ä¸€æ¬¡ KDJ æ­»å‰çš„æ—¥æœŸã€‚å¦‚æœå‘ç”Ÿåœ¨è¿‘æœŸ3ä¸ªäº¤æ˜“ä¹‹å†…ï¼ˆget_last_n_trade_dates(n=3)ï¼‰å°±æ’é™¤æ‰è¿™åªè‚¡ç¥¨ï¼›
4. è°ƒç”¨get_recent_macd_death_cross(ts_code)è·å–æŒ‡å®šè‚¡ç¥¨æœ€è¿‘ä¸€æ¬¡MACD æ­»å‰çš„æ—¥æœŸã€‚å¦‚æœå‘ç”Ÿåœ¨è¿‘æœŸ3ä¸ªäº¤æ˜“ä¹‹å†…ï¼ˆget_last_n_trade_dates(n=3)ï¼‰å°±æ’é™¤æ‰è¿™åªè‚¡ç¥¨ï¼›
5. æ ¹æ®ä»¥ä¸‹è§„åˆ™ç­›é€‰è‚¡ç¥¨ï¼š
  - ä¿ç•™æˆäº¤é¢ié™åºæ’åå‰6ä¸ªè‚¡ç¥¨ï¼›**ï¼ˆconfig.yamlä¸­top_volumeæŒ‡å®šï¼‰**
  - æ¶¨å¹…é™åºæ’åˆ—çš„å‰3åï¼›**ï¼ˆconfig.yamlä¸­top_pct_chgæŒ‡å®šï¼‰**
  - æ’é™¤æ‰è¿‘3ä¸ªäº¤æ˜“ä¹‹å†… KDJ æ­»å‰çš„è‚¡ç¥¨ï¼›**(æš‚æœªåŠ å…¥)**
  - æ’é™¤æ‰è¿‘3ä¸ªäº¤æ˜“ä¹‹å†…MACD  æ­»å‰çš„è‚¡ç¥¨ï¼›**(æš‚æœªåŠ å…¥)**
6. ä¿å­˜ç­›é€‰ç»“æœä¸º `tushare_stock_basic_filter4_äº¤æ˜“æ—¥æœŸ.csv` æ–‡ä»¶ã€‚

#### è¾“å…¥å†…å®¹

1. äº¤æ˜“æ—¥æœŸï¼šæœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥ï¼ˆé€šè¿‡ get_last_trade_date è·å–ï¼‰ã€‚
2. è¾“å…¥æ–‡ä»¶ï¼štushare_stock_basic_filter3_äº¤æ˜“æ—¥æœŸ_merged.csvï¼ˆåŒ…å«è´¢åŠ¡æ•°æ®å’ŒåŸºæœ¬ä¿¡æ¯çš„è‚¡ç¥¨åˆ—è¡¨ï¼‰ã€‚

#### è¾“å‡ºæ–‡ä»¶å’Œå†…å®¹

CSV æ–‡ä»¶ï¼š`tushare_stock_basic_filter4_äº¤æ˜“æ—¥æœŸ.csv` åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
  - `ts_code`ï¼šè‚¡ç¥¨ä»£ç ã€‚
  - `name`ï¼šè‚¡ç¥¨åç§°ã€‚
  - `area`ï¼šåœ°åŸŸã€‚
  - `industry`ï¼šæ‰€å±è¡Œä¸šã€‚
  - `market`ï¼šå¸‚åœºç±»å‹ã€‚
  - `list_status`ï¼šä¸Šå¸‚çŠ¶æ€ã€‚
  - `list_date`ï¼šä¸Šå¸‚æ—¥æœŸã€‚
  - `is_hs`ï¼šæ˜¯å¦æ²ªæ·±æ¸¯é€šæ ‡çš„ã€‚
  - `vol`ï¼šæˆäº¤é‡ã€‚
  - `turnover_rate`ï¼šæ¢æ‰‹ç‡ã€‚
  - `pct_chg`ï¼šæ¶¨è·Œå¹…ã€‚
  - `circ_mv`ï¼šæµé€šå¸‚å€¼ã€‚
  - `volume_ratio`ï¼šé‡æ¯”ã€‚
  - `ann_date`ï¼šå…¬å‘Šæ—¥æœŸã€‚  
  - `end_date`ï¼šæŠ¥å‘ŠæœŸã€‚  
  - `roe`ï¼šå‡€èµ„äº§æ”¶ç›Šç‡ã€‚  
  - `fcff`ï¼šä¼ä¸šè‡ªç”±ç°é‡‘æµé‡ã€‚  
  - `grossprofit_margin`ï¼šé”€å”®æ¯›åˆ©ç‡ã€‚  
  - `equity_yoy`ï¼šå‡€èµ„äº§åŒæ¯”å¢é•¿ç‡ã€‚  
  - `debt_to_assets`ï¼šèµ„äº§è´Ÿå€ºç‡ã€‚  
  - `update_flag`ï¼šæ›´æ–°æ ‡è¯†ã€‚

---


## ç›¸å…³èµ„æºè¯´æ˜

### å·¥å…·ç±»stock_utils

```
get_tushare_api()
åˆå§‹åŒ–å¹¶è¿”å› Tushare API å¯¹è±¡ã€‚
è¾“å‡º: Tushare API å¯¹è±¡ã€‚

is_file_older_than(file_path, days=1)
åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ—©äºæŒ‡å®šå¤©æ•°ã€‚
è¾“å…¥: file_path (æ–‡ä»¶è·¯å¾„), days (å¤©æ•°, é»˜è®¤ä¸º 1)ã€‚
è¾“å‡º: True æˆ– Falseã€‚

get_quarter_end_dates(year)
è·å–æŒ‡å®šå¹´ä»½çš„å­£åº¦ç»“æŸæ—¥æœŸã€‚
è¾“å…¥: year (å¹´ä»½)ã€‚
è¾“å‡º: åŒ…å«å­£åº¦ç»“æŸæ—¥æœŸçš„å­—å…¸ã€‚

generate_quarter_list(start_year)
ç”Ÿæˆä»æŒ‡å®šå¹´ä»½åˆ°å½“å‰å¹´ä»½çš„å­£åº¦åˆ—è¡¨ã€‚
è¾“å…¥: start_year (èµ·å§‹å¹´ä»½)ã€‚
è¾“å‡º: åŒ…å«å­£åº¦ä¿¡æ¯çš„åˆ—è¡¨ã€‚

auto_adjust_column_width(file_path)
è‡ªåŠ¨è°ƒæ•´ Excel æ–‡ä»¶çš„åˆ—å®½ã€‚
è¾“å…¥: file_path (Excel æ–‡ä»¶è·¯å¾„)ã€‚
è¾“å‡º: æ— ï¼ˆä¿®æ”¹æ–‡ä»¶ï¼‰ã€‚

get_last_trade_date()
è·å–æœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥çš„æ—¥æœŸã€‚
è¾“å‡º: æœ€è¿‘ä¸€ä¸ªäº¤æ˜“æ—¥çš„æ—¥æœŸï¼Œè‹¥æ— åˆ™è¿”å› Noneã€‚

get_last_n_trade_dates(n=20)
è·å–æœ€è¿‘ n ä¸ªäº¤æ˜“æ—¥çš„æ—¥æœŸã€‚
è¾“å…¥: n (äº¤æ˜“æ—¥æ•°é‡, é»˜è®¤ä¸º 20)ã€‚
è¾“å‡º: åŒ…å«äº¤æ˜“æ—¥æœŸçš„åˆ—è¡¨ã€‚

fetch_stock_basic(trade_date, is_save_csv=True)
è·å–è‚¡ç¥¨åŸºç¡€ä¿¡æ¯å¹¶ä¿å­˜ä¸º CSV æ–‡ä»¶ã€‚
è¾“å…¥: trade_date (äº¤æ˜“æ—¥æœŸ)ã€‚
è¾“å‡º: dfï¼ˆä¿å­˜ä¸º CSV æ–‡ä»¶ï¼‰ã€‚

fetch_daily(trade_date, is_save_csv=True)
è·å–æ—¥çº¿è¡Œæƒ…æ•°æ®å¹¶ä¿å­˜ä¸º CSV æ–‡ä»¶ã€‚
è¾“å…¥: trade_date (äº¤æ˜“æ—¥æœŸ)ã€‚
è¾“å‡º: dfï¼ˆä¿å­˜ä¸º CSV æ–‡ä»¶ï¼‰ã€‚

fetch_daily_basic(trade_date, is_save_csv=True)
è·å–æ¯æ—¥æŒ‡æ ‡æ•°æ®å¹¶ä¿å­˜ä¸º CSV æ–‡ä»¶ã€‚
è¾“å…¥: trade_date (äº¤æ˜“æ—¥æœŸ)ã€‚
è¾“å‡º: dfï¼ˆä¿å­˜ä¸º CSV æ–‡ä»¶ï¼‰ã€‚

fetch_stk_factor_pro_by_tscode(ts_code, start_date, end_date)
è·å–æŒ‡å®šè‚¡ç¥¨ä»£ç åœ¨æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„è‚¡ç¥¨å› å­æ•°æ®ã€‚
è¾“å…¥: ts_code (è‚¡ç¥¨ä»£ç ), start_date (å¼€å§‹æ—¥æœŸ), end_date (ç»“æŸæ—¥æœŸ)ã€‚
è¾“å‡º: è‚¡ç¥¨å› å­æ•°æ®çš„ DataFrameã€‚

ensure_sufficient_data(ts_code, min_days)
ç¡®ä¿è·å–æŒ‡å®šè‚¡ç¥¨çš„è¶³å¤Ÿå¤©æ•°çš„æ•°æ®ã€‚
è¾“å…¥: ts_code (è‚¡ç¥¨ä»£ç ), min_days (æœ€å°å¤©æ•°)ã€‚
è¾“å‡º: è‡³å°‘ min_days å¤©çš„æ•°æ®çš„ DataFrameã€‚

get_recent_kdj_death_cross(ts_code)
è·å–æŒ‡å®šè‚¡ç¥¨æœ€è¿‘ä¸€æ¬¡ KDJ æ­»å‰çš„æ—¥æœŸã€‚
è¾“å…¥: ts_code (è‚¡ç¥¨ä»£ç )ã€‚
è¾“å‡º: æœ€è¿‘ä¸€æ¬¡ KDJ æ­»å‰çš„æ—¥æœŸï¼Œè‹¥æ— åˆ™è¿”å› Noneã€‚

get_recent_macd_death_cross(ts_code)
è·å–æŒ‡å®šè‚¡ç¥¨æœ€è¿‘ä¸€æ¬¡ MACD æ­»å‰çš„æ—¥æœŸã€‚
è¾“å…¥: ts_code (è‚¡ç¥¨ä»£ç )ã€‚
è¾“å‡º: æœ€è¿‘ä¸€æ¬¡ MACD æ­»å‰çš„æ—¥æœŸï¼Œè‹¥æ— åˆ™è¿”å› Noneã€‚

fetch_fina_indicator_vip_by_tscode(ts_code, quarter_list, is_save_csv=True)
è·å–æŒ‡å®šè‚¡ç¥¨çš„æ‰€æœ‰è´¢åŠ¡æ•°æ®ã€‚
è¾“å…¥: ts_code (è‚¡ç¥¨ä»£ç )ï¼Œquarter_listï¼ˆåŒ…å«å­£åº¦ä¿¡æ¯çš„åˆ—è¡¨ï¼‰ã€‚
è¾“å‡º: dfï¼ˆä¿å­˜ä¸º CSV æ–‡ä»¶ï¼‰ã€‚

def fetch_fina_indicator_vip_by_tscode_quarter_str(ts_code, quarter_str, is_save_csv=False)
è·å–æŒ‡å®šè‚¡ç¥¨æŒ‡å®šæ—¶é—´çš„è´¢åŠ¡æ•°æ®ã€‚
è¾“å…¥: ts_code (è‚¡ç¥¨ä»£ç )ï¼Œquarter_strï¼ˆåŒ…å«è´¢æŠ¥æ—¶é—´å­—ç¬¦ä¸²ï¼‰ã€‚
è¾“å‡º: dfï¼ˆä¿å­˜ä¸º CSV æ–‡ä»¶ï¼‰ã€‚

```

### APIæ¥å£è¿”å›å­—æ®µè¯´æ˜

#### åŸºç¡€ä¿¡æ¯APIæ¥å£stock_basic

 - å‡½æ•°ï¼šfetch_stock_basic(trade_date)
 - æè¿°ï¼šå¯ä»¥è·å–æ‰€æœ‰ä¸Šå¸‚å…¬å¸åŸºç¡€ä¿¡æ¯ï¼Œè°ƒå–ä¸€æ¬¡å°±å¯ä»¥æ‹‰å–å®Œã€‚
 - è¾“å…¥ï¼šget_last_trade_dateè·å–æœ€è¿‘çš„ä¸€ä¸ªäº¤æ˜“æ—¥æœŸåï¼Œè¾“å…¥å‚æ•°trade_dateï¼ŒAPIæ¥å£stock_basicè·å–æ‰€æœ‰ä¸Šå¸‚å…¬å¸åŸºç¡€ä¿¡æ¯ã€‚
 - è¾“å‡ºï¼šè·å–æ•°æ®ååˆ†åˆ«å†™å…¥csvæ–‡ä»¶ï¼Œcsvæ–‡ä»¶åååŠ å½“å‰æ—¥æœŸï¼Œä¾‹å¦‚ï¼štushare_stock_basic_20250211.csvã€‚
 - csvæ–‡ä»¶å†…æ•°æ®ä¿ç•™å­—æ®µå¦‚ä¸‹ï¼š
```
åç§°	ç±»å‹	é»˜è®¤æ˜¾ç¤º	æè¿°
ts_code	str	Y	TSä»£ç 
symbol	str	Y	è‚¡ç¥¨ä»£ç 
name	str	Y	è‚¡ç¥¨åç§°
area	str	Y	åœ°åŸŸ
industry	str	Y	æ‰€å±è¡Œä¸š
fullname	str	N	è‚¡ç¥¨å…¨ç§°
enname	str	N	è‹±æ–‡å…¨ç§°
cnspell	str	Y	æ‹¼éŸ³ç¼©å†™
market	str	Y	å¸‚åœºç±»å‹ï¼ˆä¸»æ¿/åˆ›ä¸šæ¿/ç§‘åˆ›æ¿/CDRï¼‰
exchange	str	N	äº¤æ˜“æ‰€ä»£ç 
curr_type	str	N	äº¤æ˜“è´§å¸
list_status	str	N	ä¸Šå¸‚çŠ¶æ€ Lä¸Šå¸‚ Dé€€å¸‚ Pæš‚åœä¸Šå¸‚
list_date	str	Y	ä¸Šå¸‚æ—¥æœŸ
delist_date	str	N	é€€å¸‚æ—¥æœŸ
is_hs	str	N	æ˜¯å¦æ²ªæ·±æ¸¯é€šæ ‡çš„ï¼ŒNå¦ Hæ²ªè‚¡é€š Sæ·±è‚¡é€š
act_name	str	Y	å®æ§äººåç§°
act_ent_type	str	Y	å®æ§äººä¼ä¸šæ€§è´¨
```

#### æ—¥çº¿è¡Œæƒ…APIæ¥å£daily

 - å‡½æ•°ï¼šfetch_daily(trade_date)
 - æè¿°ï¼šæœ¬æ¥å£æ˜¯æœªå¤æƒè¡Œæƒ…ï¼Œåœç‰ŒæœŸé—´ä¸æä¾›æ•°æ®ã€‚åªéœ€è¾“å…¥å‚æ•°trade_dateï¼Œå³å¯è·å–æ‰€æœ‰ä¸Šå¸‚å…¬å¸æ—¥çº¿è¡Œæƒ…æ•°æ®ã€‚
 - è¾“å…¥ï¼šget_last_20_trade_datesè·å¾—æœ€è¿‘çš„20ä¸ªäº¤æ˜“æ—¥æœŸåˆ—è¡¨åï¼Œå¾ªç¯è¾“å…¥äº¤æ˜“æ—¥å‚æ•°trade_dateï¼ŒAPIæ¥å£dailyè·å–æ‰€æœ‰ä¸Šå¸‚å…¬å¸è¿‘20ä¸ªäº¤æ˜“æ—¥çš„æ‰€æœ‰æ•°æ®ã€‚
 - è¾“å‡ºï¼šè·å–æ•°æ®ååˆ†åˆ«å†™å…¥csvæ–‡ä»¶ï¼Œcsvæ–‡ä»¶åååŠ trade_dateäº¤æ˜“æ—¥æœŸï¼Œä¾‹å¦‚ï¼štushare_daily_20250211.csvã€‚
 - csvæ–‡ä»¶å†…æ•°æ®ä¿ç•™å­—æ®µå¦‚ä¸‹ï¼š
```
åç§°	ç±»å‹	æè¿°
ts_code	str	è‚¡ç¥¨ä»£ç 
trade_date	str	äº¤æ˜“æ—¥æœŸ
open	float	å¼€ç›˜ä»·
high	float	æœ€é«˜ä»·
low	float	æœ€ä½ä»·
close	float	æ”¶ç›˜ä»·
pre_close	float	æ˜¨æ”¶ä»·ã€é™¤æƒä»·ï¼Œå‰å¤æƒã€‘
change	float	æ¶¨è·Œé¢
pct_chg	float	æ¶¨è·Œå¹… ã€åŸºäºé™¤æƒåçš„æ˜¨æ”¶è®¡ç®—çš„æ¶¨è·Œå¹…ï¼šï¼ˆä»Šæ”¶-é™¤æƒæ˜¨æ”¶ï¼‰/é™¤æƒæ˜¨æ”¶ ã€‘
vol	float	æˆäº¤é‡ ï¼ˆæ‰‹ï¼‰
amount	float	æˆäº¤é¢ ï¼ˆåƒå…ƒï¼‰
```

#### æ¯æ—¥æŒ‡æ ‡APIæ¥å£daily_basic

 - å‡½æ•°ï¼šfetch_daily_basic(trade_date)
 - æè¿°ï¼šå¯è·å–å…¨éƒ¨è‚¡ç¥¨æ¯æ—¥é‡è¦çš„åŸºæœ¬é¢æŒ‡æ ‡ï¼Œå¯ç”¨äºé€‰è‚¡åˆ†æã€æŠ¥è¡¨å±•ç¤ºç­‰ã€‚
 - è¾“å…¥ï¼šget_last_20_trade_datesè·å¾—æœ€è¿‘çš„20ä¸ªäº¤æ˜“æ—¥æœŸåˆ—è¡¨åï¼Œå¾ªç¯è¾“å…¥äº¤æ˜“æ—¥å‚æ•°trade_dateï¼ŒAPIæ¥å£daily_basicè·å–å…¨éƒ¨è‚¡ç¥¨è¿‘20ä¸ªäº¤æ˜“æ—¥çš„æ¯æ—¥é‡è¦çš„åŸºæœ¬é¢æŒ‡æ ‡æ•°æ®ã€‚
 - è¾“å‡ºï¼šè·å–æ•°æ®ååˆ†åˆ«å†™å…¥csvæ–‡ä»¶ï¼Œcsvæ–‡ä»¶åååŠ trade_dateäº¤æ˜“æ—¥æœŸï¼Œä¾‹å¦‚ï¼štushare_daily_basic_20250211.csvã€‚
 - csvæ–‡ä»¶å†…æ•°æ®ä¿ç•™å­—æ®µå¦‚ä¸‹ï¼š
```
åç§°	ç±»å‹	æè¿°
ts_code	str	TSè‚¡ç¥¨ä»£ç 
trade_date	str	äº¤æ˜“æ—¥æœŸ
close	float	å½“æ—¥æ”¶ç›˜ä»·
turnover_rate	float	æ¢æ‰‹ç‡ï¼ˆ%ï¼‰
turnover_rate_f	float	æ¢æ‰‹ç‡ï¼ˆè‡ªç”±æµé€šè‚¡ï¼‰
volume_ratio	float	é‡æ¯”
pe	float	å¸‚ç›ˆç‡ï¼ˆæ€»å¸‚å€¼/å‡€åˆ©æ¶¦ï¼Œ äºæŸçš„PEä¸ºç©ºï¼‰
pe_ttm	float	å¸‚ç›ˆç‡ï¼ˆTTMï¼ŒäºæŸçš„PEä¸ºç©ºï¼‰
pb	float	å¸‚å‡€ç‡ï¼ˆæ€»å¸‚å€¼/å‡€èµ„äº§ï¼‰
ps	float	å¸‚é”€ç‡
ps_ttm	float	å¸‚é”€ç‡ï¼ˆTTMï¼‰
dv_ratio	float	è‚¡æ¯ç‡ ï¼ˆ%ï¼‰
dv_ttm	float	è‚¡æ¯ç‡ï¼ˆTTMï¼‰ï¼ˆ%ï¼‰
total_share	float	æ€»è‚¡æœ¬ ï¼ˆä¸‡è‚¡ï¼‰
float_share	float	æµé€šè‚¡æœ¬ ï¼ˆä¸‡è‚¡ï¼‰
free_share	float	è‡ªç”±æµé€šè‚¡æœ¬ ï¼ˆä¸‡ï¼‰
total_mv	float	æ€»å¸‚å€¼ ï¼ˆä¸‡å…ƒï¼‰
circ_mv	float	æµé€šå¸‚å€¼ï¼ˆä¸‡å…ƒï¼‰
```

###  æ•°æ®åˆå§‹åŒ–ç¨‹åº - init.py

#### åŠŸèƒ½æè¿°
è¿è¡Œinit.pyä¸»ç¨‹åºï¼Œå°†è‡ªåŠ¨è°ƒç”¨get_last_n_trade_dates(n=20)è·å¾—æœ€è¿‘çš„20ä¸ªäº¤æ˜“æ—¥æœŸåˆ—è¡¨åï¼Œç”Ÿæˆ3ä¸ªæ¥å£ï¼ˆåŸºç¡€ä¿¡æ¯APIæ¥å£stock_basicã€æ—¥çº¿è¡Œæƒ…APIæ¥å£dailyã€æ¯æ—¥æŒ‡æ ‡APIæ¥å£daily_basicï¼‰è¿‘20ä¸ªäº¤æ˜“æ—¥çš„csvæ–‡ä»¶åï¼ˆtushare_stock_basic_äº¤æ˜“æ—¥æœŸ.csvã€tushare_daily_äº¤æ˜“æ—¥æœŸ.csvã€tushare_daily_basic_äº¤æ˜“æ—¥æœŸ.csvï¼‰ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå‘ç°ä¸å­˜åœ¨å°±è°ƒç”¨ç›¸åº”æ¥å£ç”Ÿæˆcsvæ–‡ä»¶ï¼Œä¾æ¬¡å®Œæˆcsvæ•°æ®æ–‡ä»¶çš„ç”Ÿæˆå·¥ä½œã€‚

#### è¾“å…¥å†…å®¹
 - get_last_n_trade_dates(n=20)è·å¾—æœ€è¿‘çš„20ä¸ªäº¤æ˜“æ—¥æœŸ

#### è¾“å‡ºå†…å®¹
 - ç”Ÿæˆ3ä¸ªæ¥å£ï¼ˆåŸºç¡€ä¿¡æ¯APIæ¥å£stock_basicã€æ—¥çº¿è¡Œæƒ…APIæ¥å£dailyã€æ¯æ—¥æŒ‡æ ‡APIæ¥å£daily_basicï¼‰è¿‘20ä¸ªäº¤æ˜“æ—¥çš„csvæ–‡ä»¶ï¼ˆtushare_stock_basic_äº¤æ˜“æ—¥æœŸ.csvã€tushare_daily_äº¤æ˜“æ—¥æœŸ.csvã€tushare_daily_basic_äº¤æ˜“æ—¥æœŸ.csvï¼‰



## åç»­å¼€å‘è®¡åˆ’

1. å¢åŠ å¤šå› å­å›å½’åˆ†æ
2. å®ç°ç­–ç•¥å›æµ‹æ¡†æ¶
3. å¼€å‘GUIæ“ä½œç•Œé¢
4. æ·»åŠ å›½é™…å¸‚åœºæ•°æ®æ”¯æŒ

## å…è´£å£°æ˜

æœ¬å·¥å…·ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚è‚¡å¸‚æœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…ã€‚å®é™…æŠ•èµ„å†³ç­–åº”è€ƒè™‘æ›´å¤šå› ç´ ï¼Œå»ºè®®å’¨è¯¢ä¸“ä¸šæŠ•èµ„é¡¾é—®ã€‚

æ¬¢è¿è´¡çŒ®ä»£ç æˆ–æå‡ºæ”¹è¿›å»ºè®®ï¼


